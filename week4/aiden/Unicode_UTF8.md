# Handling Characters

[https://www.w3.org/International/articles/definitions-characters/](https://www.w3.org/International/articles/definitions-characters/)

Unicode

- 유니코드란 문자를 고유의 숫자코드와 매핑해놓은 국제 기준이다.
- 유니코드는 인코딩, 디코딩과는 무관하게 A는 65, y는 121, 가는 44032이다라고 정의해놓은 것이다. 그리고 이렇게 각 문자마다 부여된 고유의 숫자값을 **Code Point**라고 부른다. 코드포인트는 보통  U+(헥사코드값)의 형태로 표현된다. 예를 들어 U+007F는 Del을 표현하는 유니코드이며 십진법으로 바꾼 값은 127이다.
- 총 143,859 개의 문자가 정의되어 있으며 가장 많이 쓰이는 첫 65,536개의 문자는 **Basic Multilingual Plane(BMP)**라고 부른다.

```jsx
자바스크립트에서 code point는 codePointAt() 함수로 확인할 수 있다.

"가".codePointAt() // 44032
"가".codePointAt().toString(2) // 1010110000000000

```

Encoding

- 유니코드를 통해 A의 코드포인트를 65라고 정의했다. 그런데 이를 **컴퓨터가 이해할 수 있는 이진법(비트)으로 표현**해야한다. 이 변환 과정이 바로 인코딩이다. 그런데 65라는 값을 이진법으로 표현할 수 있는 방법은 사실 여러가지다. 1000001도 65이지만 **000000001000001**도 65이다. 

**이렇게 코드포인트를 이진법으로 변환할 때 1바이트 씩 끊을 것이냐 2바이트씩 끊을 것이냐, 나아가 코드포인트가 1바이트 이상인 문자를 어떤 규칙으로 표현할 것이냐 등에 따라 인코딩 방법은 여러가지가 될 수 있다.**
- 그 중에 대표적으로 쓰이는 UTF8에 대해 알아보자. UTF8은 이름에서 알 수 있듯이 1바이트(8비트) 단위로 끊는다. 

**UTF8에서 첫번째 바이트는 해당 문자가 총 몇바이트인지 대한 정보를 담고있다.** 

이렇게 길이에 대한 정보가 없을 시 문자를 어디서 끊어야할지 알 수가 없다.
예를 들어, 00000001 00000001라는 값이 U+0001에 해당하는 SOH 값이 두 번있는 것인지 0000000100000001 와 같이 u+0101에 해당하는 ā 값을 표현하는 건지 알 수 없다. 
그래서 각 문자의 첫번째 바이트는 0xxxxxxx(1바이트), 110xxxxxx(2바이트), 1110xxxx(3바이트) 이런식으로 문자가 총 몇 바이트인지에 대한 정보를 담고있다. 그리고 이후의 이어지는 바이트는 모두 10xxxxxx으로 표현되어 **continuation bytes**로 불린다.
- 따라서 UTF8으로 4바이트짜리 문자는 아래와 같이 표현된다. x로 사용가능한 비트가 총 21개로 2,097,152까지 표현할 수 있다. 그런데 위에서 유니코드는 143,859개까지 정의되어 있다고 했다. 4바이트면 모든 문자를 커버할 수 있기 때문에 UTF8은 최대 4바이트가 된다.
11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
- 자바스크립트에서 UTF8이 쓰이는 대표적인 예가 encodeURIComponent함수이다. 쿼리파라미터 등 URI에 들어가는 특수문자를 인코딩할 때 쓰인다.

```jsx
encodeURIComponent("가") // %EA%B0%80
0xEA.toString(2) // 11101010
0xB0.toString(2) // 10110000
0x80.toString(2) // 10000000

// "가".codePointAt().toString(2) // 1010110000000000
```

- encodeURIComponent("가")의 결과가 총 3개의 헥사코드로 나왔다. (EA, B0, 80)이를 각각 비트로 표현하면 11101010, 10110000, 10000000이다. 익숙한 패턴이다.
**1110**1010 **10**110000 **10**000000
바이트 개수와 Continuation Bytes를 표현한 노란 비트를 제외한 값을 합치면
1010110000000000이 된다.

"가"의 코드포인트는 44032이다. 이를 비트로 변환하면 어떤 값이 될까. 1010110000000000이다.
